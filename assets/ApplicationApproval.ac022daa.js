import{d as defineComponent,aa as computed,g as ref,Y as reactive,ab as onUpdated,i as onBeforeMount,r as resolveComponent,E as ElTooltip,ac as ElPopover,o as openBlock,c as createElementBlock,b as createVNode,w as withCtx,a as createBaseVNode,G as createTextVNode,t as toDisplayString,F as Fragment,x as renderList,e as createBlock,u as unref,ad as select_default,ae as semi_select_default,af as edit_default,ag as check_default,Q as createCommentVNode,ah as close_default,s as withDirectives,y as vShow,a8 as withModifiers,U as put,a0 as ElMessage,ai as ElDescriptionsItem,aj as ElDescriptions,q as ElButton,a6 as ElPopconfirm,ak as ElEmpty,a5 as ElTag,Z as ElDrawer,al as ElAlert,k as ElOption,n as ElSelect,am as ElInputNumber,N as ElFormItem,O as ElForm,K as ElDialog,v as vLoading,A as pushScopeId,B as popScopeId,V as post,_ as _export_sfc,h as useAsyncState,j as watch,an as usePermissionStore,a3 as ElCol,ao as ElBadge,p as ElRow,ap as ElTabPane,f as ElIcon,aq as ElTabs,a4 as ElTableColumn,z as get,ar as resolveDirective,$ as normalizeClass,as as isRef,at as circle_check_filled_default,au as circle_close_filled_default,a7 as ElTable}from"./index.594ced5a.js";/* empty css                   *//* empty css                   *//* empty css                    *//* empty css               *//* empty css               *//* empty css                 *//* empty css               *//* empty css                 *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                   *//* empty css                  *//* empty css                 *//* empty css                             */const elTabs="",elTabPane="",elBadge="",_withScopeId$1=r=>(pushScopeId("data-v-e4d63e51"),r=r(),popScopeId(),r),_hoisted_1$1={class:"expand-wrapper"},_hoisted_2$1=_withScopeId$1(()=>createBaseVNode("p",{class:"emphasis"},"Other Personal Details",-1)),_hoisted_3$1=_withScopeId$1(()=>createBaseVNode("div",{class:"cell-item"}," userID ",-1)),_hoisted_4$1=_withScopeId$1(()=>createBaseVNode("div",{class:"cell-item"}," email ",-1)),_hoisted_5$1=_withScopeId$1(()=>createBaseVNode("div",{class:"cell-item"}," AUID ",-1)),_hoisted_6$1=_withScopeId$1(()=>createBaseVNode("div",{class:"cell-item"}," Submitted DateTime ",-1)),_hoisted_7$1=_withScopeId$1(()=>createBaseVNode("div",{class:"cell-item"}," Other contracts ",-1)),_hoisted_8$1=_withScopeId$1(()=>createBaseVNode("br",null,null,-1)),_hoisted_9$1=_withScopeId$1(()=>createBaseVNode("p",{class:"emphasis"},"Preference Course",-1)),_hoisted_10$1=createTextVNode(" No Preference Course "),_hoisted_11={style:{"text-align":"center"}},_hoisted_12={style:{float:"left"}},_hoisted_13={class:"course-select-option",style:{float:"right"}},_hoisted_14=_withScopeId$1(()=>createBaseVNode("p",{class:"emphasis"},"Prerequisite",-1)),_hoisted_15={key:0},_hoisted_16=_withScopeId$1(()=>createBaseVNode("p",{class:"emphasis"},"Tutor Responsibility",-1)),_hoisted_17={key:1},_hoisted_18=_withScopeId$1(()=>createBaseVNode("p",{class:"emphasis"},"Marker Responsibility",-1)),_hoisted_19=createTextVNode("Add a course"),_hoisted_20={class:"dialog-footer"},_hoisted_21=createTextVNode("Cancel"),_hoisted_22=createTextVNode("Accept"),_sfc_main$1=defineComponent({__name:"ApprovalTable",props:["applicationApprovalList","isLoading","tagIndex","course","isCourseLoading","tutorOrMarker"],emits:["update:applicationApprovalList","update:isLoading","update:tagIndex","reloadApplicationApprovalList"],setup(__props,{emit}){const props=__props,applicationApprovalListSync=computed({get(){return props.applicationApprovalList},set(r){emit("update:applicationApprovalList",r)}}),isLoadingSync=computed({get(){return props.isLoading},set(r){emit("update:isLoading",r)}}),tagIndexSync=computed({get(){return props.tagIndex},set(r){emit("update:tagIndex",r)}}),reloadApplicationApprovalList=()=>{emit("reloadApplicationApprovalList")},coursedrawerSize=ref(),operationFixed=ref("right");setInterval(()=>{coursedrawerSize.value=getWidth()>768?"40%":"100%"},2e3);const getWidth=()=>window.innerWidth,responsiveLayout=()=>{coursedrawerSize.value=getWidth()>768?"40%":"100%",operationFixed.value=getWidth()>768?"right":""},coursedrawer=ref(!1),coursedrawerData=ref({}),showCourseDrawer=({row:r})=>{coursedrawerData.value=r,console.log(coursedrawerData.value),coursedrawer.value=!0},enrollDialogVisible=ref(!1),closedCourseAvailableHoursAlert=ref(),currentApplicationID=ref(),acceptToServerLoading=ref(!1),setClosedCourseAvailableHoursAlert=()=>{localStorage.setItem("closedCourseAvailableHoursAlert","false"),closedCourseAvailableHoursAlert.value=!1},acceptEvent=r=>{singleEnrollForm.domains=[],r.PreferCourse!==null&&r.PreferCourse!==void 0&&r.PreferCourse.forEach(s=>{singleEnrollForm.domains.push({courseID:s.courseID,estimatedHours:0})}),currentApplicationID.value=r.applicationID,enrollDialogVisible.value=!0};ref();const singleEnrollForm=reactive({domains:[]}),removeDomain=r=>{const s=singleEnrollForm.domains.indexOf(r);s!==-1&&singleEnrollForm.domains.splice(s,1)},addDomain=()=>{singleEnrollForm.domains.push({courseID:void 0,estimatedHours:0}),console.log(singleEnrollForm.domains)},acceptToServer=()=>{acceptToServerLoading.value=!0,put(`api/applicationApproval/${currentApplicationID.value}/Accepted`,{data:singleEnrollForm.domains}).then(r=>{reloadApplicationApprovalList(),ElMessage.success("Accept successfully!"),acceptToServerLoading.value=!1,enrollDialogVisible.value=!1}).catch(r=>{console.log(r),ElMessage({message:r.response.data.message,type:"error"}),acceptToServerLoading.value=!1})},rejectToServerLoading=ref(!1),rejectToServer=r=>{rejectToServerLoading.value=!0,put(`api/applicationApproval/${r.applicationID}/Rejected`,{}).then(s=>{reloadApplicationApprovalList(),ElMessage.success("Reject successfully!"),rejectToServerLoading.value=!1}).catch(s=>{console.log(s),ElMessage({message:s.response.data.message,type:"error"}),rejectToServerLoading.value=!1})},xTable=ref({}),boolean=ref(["true","false"]),studentDegree=ref(["Undergraduate","Postgraduate"]);onUpdated(()=>{xTable.value.refreshColumn()});const autoSaveUpdateEvent=async(r,s)=>{const o=xTable.value;if(console.log(o.getRecordset()),o.getRecordset(),!await(o==null?void 0:o.validate()))try{await post(`api/saveApplication/${s}`,{applicationPersonalDetail:r}).then(p=>{ElMessage({message:"Save success",type:"success"}),reloadApplicationApprovalList()}).catch(p=>{ElMessage({message:p.response.data.message,type:"error"}),reloadApplicationApprovalList()})}catch(p){p&&p.message&&ElMessage({message:p.message,type:"error"}),reloadApplicationApprovalList()}},editRowEvent=r=>{xTable.value.setEditRow(r)},saveRowEvent=row=>{const $table=xTable.value;$table.clearEdit().then(()=>{isLoadingSync.value=!0;const toServerRow={upi:row.upi,name:row.name,studentDegree:row.studentDegree,haveOtherContracts:eval(row.haveOtherContracts),maximumWorkingHours:row.maximumWorkingHours,gpa:row.gpa,currentlyOverseas:eval(row.currentlyOverseas),willBackToNZ:eval(row.willBackToNZ),isCitizenOrPR:eval(row.isCitizenOrPR),haveValidVisa:eval(row.haveValidVisa),enrolDetails:row.enrolDetails};autoSaveUpdateEvent(toServerRow,row.applicationID)})},cancelRowEvent=r=>{const s=xTable.value;s.clearEdit().then(()=>{s.revertData(r)})},toggleExpandChangeEvent=({row:r})=>{xTable.value.refreshColumn()};return onBeforeMount(()=>{responsiveLayout(),closedCourseAvailableHoursAlert.value=localStorage.getItem("closedCourseAvailableHoursAlert")===null}),(r,s)=>{const o=resolveComponent("vxe-column"),i=ElDescriptionsItem,p=ElDescriptions,h=resolveComponent("vxe-table"),b=resolveComponent("vxe-input"),g=resolveComponent("vxe-option"),m=resolveComponent("vxe-select"),u=ElButton,T=ElTooltip,R=ElPopconfirm,y=ElEmpty,w=ElTag,H=ElDrawer,x=ElAlert,A=ElOption,N=ElPopover,z=ElSelect,I=ElInputNumber,C=ElFormItem,E=ElForm,j=ElDialog,U=vLoading;return openBlock(),createElementBlock(Fragment,null,[createVNode(h,{border:"",class:"fixed-table",height:"100%",ref_key:"xTable",ref:xTable,"column-config":{resizable:!0},"row-config":{isHover:!0},"scroll-y":{mode:"wheel"},loading:unref(isLoadingSync),"loading-config":{icon:"vxe-icon-indicator roll",text:"Loading..."},data:unref(applicationApprovalListSync),"edit-config":{trigger:"manual",mode:"row",showIcon:!1},"checkbox-config":{highlight:!0},onToggleRowExpand:toggleExpandChangeEvent},{empty:withCtx(()=>[createVNode(y,{description:"No data. Please select other Terms and Approval Type (Marker or Tutor)."})]),default:withCtx(()=>[createVNode(o,{type:"checkbox",width:"40"}),createVNode(o,{type:"expand",width:"40"},{content:withCtx(({row:l,rowIndex:t})=>[createBaseVNode("div",_hoisted_1$1,[_hoisted_2$1,createVNode(p,{class:"margin-top",column:3,border:""},{default:withCtx(()=>[createVNode(i,null,{label:withCtx(()=>[_hoisted_3$1]),default:withCtx(()=>[createTextVNode(" "+toDisplayString(l.userID),1)]),_:2},1024),createVNode(i,null,{label:withCtx(()=>[_hoisted_4$1]),default:withCtx(()=>[createTextVNode(" "+toDisplayString(l.email),1)]),_:2},1024),createVNode(i,null,{label:withCtx(()=>[_hoisted_5$1]),default:withCtx(()=>[createTextVNode(" "+toDisplayString(l.auid),1)]),_:2},1024),createVNode(i,null,{label:withCtx(()=>[_hoisted_6$1]),default:withCtx(()=>[createTextVNode(" "+toDisplayString(l.submittedDateTime),1)]),_:2},1024),createVNode(i,null,{label:withCtx(()=>[_hoisted_7$1]),default:withCtx(()=>[createTextVNode(" "+toDisplayString(l.otherContracts),1)]),_:2},1024)]),_:2},1024),_hoisted_8$1,_hoisted_9$1,createVNode(h,{border:"","show-overflow":"","row-config":{isHover:!0},data:l.PreferCourse,onCellClick:showCourseDrawer},{empty:withCtx(()=>[_hoisted_10$1]),default:withCtx(()=>[createVNode(o,{field:"preference",title:"#",width:"40"}),createVNode(o,{field:"courseNum",title:"Course Num",width:"110"}),createVNode(o,{field:"courseName",title:"Course Name"}),createVNode(o,{field:"hasLearned",title:"has Learned",width:"100"}),createVNode(o,{field:"grade",title:"Grade",width:"60"}),createVNode(o,{field:"explanation",title:"Explanation(No Learned)"}),createVNode(o,{field:"preExperience",title:"Pre Experience"})]),_:2},1032,["data"])])]),_:1}),createVNode(o,{field:"applicationID",title:"AppID",width:"65"}),createVNode(o,{field:"upi",title:"UPI","edit-render":{},width:"75"},{edit:withCtx(({row:l})=>[createVNode(b,{modelValue:l.upi,"onUpdate:modelValue":t=>l.upi=t,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(o,{field:"name",title:"Name","edit-render":{},"min-width":"100"},{edit:withCtx(({row:l})=>[createVNode(b,{modelValue:l.name,"onUpdate:modelValue":t=>l.name=t,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(o,{field:"gpa",title:"GPA","edit-render":{},width:"70",sortable:""},{edit:withCtx(({row:l})=>[createVNode(b,{modelValue:l.gpa,"onUpdate:modelValue":t=>l.gpa=t,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(o,{field:"PreferCourseGPA",title:"PreferCourse GPA",width:"110",sortable:""}),createVNode(o,{field:"currentlyOverseas",title:"Currently Overseas",width:"95","edit-render":{},filters:[{label:"true",value:!0},{label:"false",value:!1}],"filter-multiple":!1},{edit:withCtx(({row:l})=>[createVNode(m,{modelValue:l.currentlyOverseas,"onUpdate:modelValue":t=>l.currentlyOverseas=t,clearable:"",transfer:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(boolean.value,t=>(openBlock(),createBlock(g,{key:t,value:t,label:t},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(o,{field:"willBackToNZ",title:"Will back to NZ",width:"88","edit-render":{},filters:[{label:"true",value:!0},{label:"false",value:!1}],"filter-multiple":!1},{edit:withCtx(({row:l})=>[createVNode(m,{modelValue:l.willBackToNZ,"onUpdate:modelValue":t=>l.willBackToNZ=t,clearable:"",transfer:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(boolean.value,t=>(openBlock(),createBlock(g,{key:t,value:t,label:t},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(o,{field:"isCitizenOrPR",title:"is Citizen or PR",width:"79","edit-render":{},filters:[{label:"true",value:!0},{label:"false",value:!1}],"filter-multiple":!1},{edit:withCtx(({row:l})=>[createVNode(m,{modelValue:l.isCitizenOrPR,"onUpdate:modelValue":t=>l.isCitizenOrPR=t,clearable:"",transfer:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(boolean.value,t=>(openBlock(),createBlock(g,{key:t,value:t,label:t},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(o,{field:"haveValidVisa",title:"have Valid Visa",width:"100","edit-render":{},filters:[{label:"true",value:!0},{label:"false",value:!1}],"filter-multiple":!1},{edit:withCtx(({row:l})=>[createVNode(m,{modelValue:l.haveValidVisa,"onUpdate:modelValue":t=>l.haveValidVisa=t,clearable:"",transfer:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(boolean.value,t=>(openBlock(),createBlock(g,{key:t,value:t,label:t},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(o,{field:"enrolDetails",title:"Enrol Details",width:"110","edit-render":{},"show-overflow":""},{edit:withCtx(({row:l})=>[createVNode(b,{modelValue:l.enrolDetails,"onUpdate:modelValue":t=>l.enrolDetails=t,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(o,{field:"studentDegree",title:"Student Degree","edit-render":{},width:"123",filters:[{label:"Undergraduate",value:"Undergraduate"},{label:"Postgraduate",value:"Postgraduate"}],"filter-multiple":!1},{edit:withCtx(({row:l})=>[createVNode(m,{modelValue:l.studentDegree,"onUpdate:modelValue":t=>l.studentDegree=t,clearable:"",transfer:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(studentDegree.value,t=>(openBlock(),createBlock(g,{key:t,value:t,label:t},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(o,{field:"haveOtherContracts",width:"100",title:"Have other contracts","edit-render":{},filters:[{label:"true",value:!0},{label:"false",value:!1}],"filter-multiple":!1},{edit:withCtx(({row:l})=>[createVNode(m,{modelValue:l.haveOtherContracts,"onUpdate:modelValue":t=>l.haveOtherContracts=t,clearable:"",transfer:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(boolean.value,t=>(openBlock(),createBlock(g,{key:t,value:t,label:t},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(o,{field:"maximumWorkingHours",title:"Max working hours",width:"108","edit-render":{},sortable:""},{edit:withCtx(({row:l})=>[createVNode(b,{modelValue:l.maximumWorkingHours,"onUpdate:modelValue":t=>l.maximumWorkingHours=t,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),unref(tagIndexSync)!=="3"?(openBlock(),createBlock(o,{key:0,title:"Operation",width:"160",fixed:operationFixed.value},{default:withCtx(({row:l})=>[createBaseVNode("div",_hoisted_11,[xTable.value.isEditByRow(l)?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(u,{onClick:t=>saveRowEvent(l),type:"success",icon:unref(select_default),circle:"",plain:""},null,8,["onClick","icon"]),createVNode(u,{onClick:t=>cancelRowEvent(l),type:"primary",icon:unref(semi_select_default),circle:"",plain:""},null,8,["onClick","icon"])],64)):(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(T,{content:"Edit",placement:"bottom","show-after":400},{default:withCtx(()=>[createVNode(u,{onClick:t=>editRowEvent(l),type:"primary",icon:unref(edit_default),circle:"",plain:""},null,8,["onClick","icon"])]),_:2},1024),unref(tagIndexSync)!=="1"?(openBlock(),createBlock(T,{key:0,content:"Accept",placement:"bottom","show-after":400},{default:withCtx(()=>[createVNode(u,{type:"success",icon:unref(check_default),onClick:t=>acceptEvent(l),circle:""},null,8,["icon","onClick"])]),_:2},1024)):createCommentVNode("",!0),unref(tagIndexSync)!=="2"?(openBlock(),createBlock(R,{key:1,title:"Are you sure to reject the application?",onConfirm:t=>rejectToServer(l),width:"50"},{reference:withCtx(()=>[createVNode(u,{type:"danger",icon:unref(close_default),circle:""},null,8,["icon"])]),_:2},1032,["onConfirm"])):createCommentVNode("",!0)],64))])]),_:1},8,["fixed"])):createCommentVNode("",!0)]),_:1},8,["loading","loading-config","data"]),createVNode(H,{modelValue:coursedrawer.value,"onUpdate:modelValue":s[0]||(s[0]=l=>coursedrawer.value=l),title:"Preference Course Viewer",size:coursedrawerSize.value},{default:withCtx(()=>[createVNode(p,{column:4,direction:"vertical",border:""},{default:withCtx(()=>[createVNode(i,{label:"Preference"},{default:withCtx(()=>[createTextVNode(toDisplayString(coursedrawerData.value.preference),1)]),_:1}),createVNode(i,{label:"Course Number"},{default:withCtx(()=>[createTextVNode(toDisplayString(coursedrawerData.value.courseNum),1)]),_:1}),createVNode(i,{label:"Course Name"},{default:withCtx(()=>[createTextVNode(toDisplayString(coursedrawerData.value.courseName),1)]),_:1}),createVNode(i,{label:"grade"},{default:withCtx(()=>[createVNode(w,{size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(coursedrawerData.value.grade),1)]),_:1})]),_:1}),createVNode(i,{label:"Has Learned"},{default:withCtx(()=>[createTextVNode(toDisplayString(coursedrawerData.value.hasLearned),1)]),_:1}),createVNode(i,{label:"Explanation",span:3},{default:withCtx(()=>[createTextVNode(toDisplayString(coursedrawerData.value.explanation),1)]),_:1}),createVNode(i,{label:"Pre Experience",span:4},{default:withCtx(()=>[createTextVNode(toDisplayString(coursedrawerData.value.preExperience),1)]),_:1})]),_:1})]),_:1},8,["modelValue","size"]),withDirectives((openBlock(),createBlock(j,{modelValue:enrollDialogVisible.value,"onUpdate:modelValue":s[2]||(s[2]=l=>enrollDialogVisible.value=l),title:"Accept"},{footer:withCtx(()=>[createBaseVNode("span",_hoisted_20,[createVNode(u,{onClick:s[1]||(s[1]=l=>enrollDialogVisible.value=!1)},{default:withCtx(()=>[_hoisted_21]),_:1}),createVNode(u,{type:"success",onClick:acceptToServer},{default:withCtx(()=>[_hoisted_22]),_:1})])]),default:withCtx(()=>[createVNode(x,{type:"warning",effect:"dark",title:"Note: After Accept, there are not direct enrolled. It will be enrolled after clicking Publish.",style:{"margin-bottom":"11px","margin-top":"0"},"show-icon":"",center:"",closable:!1}),createVNode(x,{type:"warning",title:"Below is the preference course for this student, and you can modify them.",style:{"margin-bottom":"9px","margin-top":"0"},"show-icon":""}),createVNode(E,{model:singleEnrollForm},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(singleEnrollForm.domains,(l,t)=>(openBlock(),createBlock(C,{key:t,label:"Course"+(t+1),prop:"domains."+t+".courseID",rules:{required:!0,message:"You must choose a course",trigger:"blur"}},{default:withCtx(()=>[createVNode(z,{modelValue:l.courseID,"onUpdate:modelValue":c=>l.courseID=c,placeholder:"Input Course Num",filterable:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.course,c=>(openBlock(),createElementBlock("div",null,[createVNode(N,{placement:"right",title:c.courseNum+" - "+c.courseName,width:520,trigger:"hover","hide-after":0},{reference:withCtx(()=>[(openBlock(),createBlock(A,{key:c.courseID,label:c.courseNum,value:c.courseID},{default:withCtx(()=>[createBaseVNode("span",_hoisted_12,toDisplayString(c.courseNum),1),createBaseVNode("span",_hoisted_13,"Available Hour: "+toDisplayString(c.currentAvailableHours),1)]),_:2},1032,["label","value"]))]),default:withCtx(()=>[withDirectives(createVNode(x,{title:"Available Hours",type:"info",effect:"dark",description:"This number of Available Hours means(for this course): Total Available Hours - Pre assigned Tutor & Marker Hours - the total estimated hours that have been accepted and enrolled(include: No Published & Published)","show-icon":"",onClose:setClosedCourseAvailableHoursAlert},null,512),[[vShow,closedCourseAvailableHoursAlert.value]]),_hoisted_14,createBaseVNode("p",null,toDisplayString(c.prerequisite),1),__props.tutorOrMarker==="Tutor"?(openBlock(),createElementBlock("div",_hoisted_15,[_hoisted_16,createBaseVNode("p",null,toDisplayString(c.tutorResponsibility),1)])):__props.tutorOrMarker==="Marker"?(openBlock(),createElementBlock("div",_hoisted_17,[_hoisted_18,createBaseVNode("p",null,toDisplayString(c.markerResponsibility),1)])):createCommentVNode("",!0)]),_:2},1032,["title"])]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"]),createVNode(T,{effect:"dark",content:"Estimated working hours for the course",placement:"left"},{default:withCtx(()=>[createVNode(I,{modelValue:l.estimatedHours,"onUpdate:modelValue":c=>l.estimatedHours=c,step:1,style:{"margin-left":"8px"},min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),createVNode(u,{style:{"margin-left":"8px"},onClick:withModifiers(c=>removeDomain(l),["prevent"]),icon:"Delete",type:"danger",circle:"",plain:""},null,8,["onClick"])]),_:2},1032,["label","prop"]))),128)),createVNode(C,null,{default:withCtx(()=>[createVNode(u,{onClick:addDomain,type:"primary"},{default:withCtx(()=>[_hoisted_19]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])),[[U,acceptToServerLoading.value]])],64)}}}),ApprovalTable_vue_vue_type_style_index_0_scoped_e4d63e51_lang="",ApprovalTable=_export_sfc(_sfc_main$1,[["__scopeId","data-v-e4d63e51"]]),_withScopeId=r=>(pushScopeId("data-v-fbb2b1d2"),r=r(),popScopeId(),r),_hoisted_1={class:"page-container"},_hoisted_2=createTextVNode(" Publish "),_hoisted_3=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_4=createTextVNode(" \xA0 Pending "),_hoisted_5=createTextVNode(" \xA0 Accepted "),_hoisted_6=createTextVNode(" \xA0 Rejected "),_hoisted_7=createTextVNode(" \xA0 Published "),_hoisted_8={class:"dialog-footer"},_hoisted_9=createTextVNode("Cancel"),_hoisted_10=createTextVNode("Confirm"),_sfc_main=defineComponent({__name:"ApplicationApproval",setup(r){const s=ref(),o=ref(""),i=ref("0"),{isLoading:p,state:h,isReady:b,execute:g}=useAsyncState(n=>get("api/term"),{},{resetOnExecute:!1}),{isLoading:m,state:u,isReady:T,execute:R}=useAsyncState(n=>get(`api/applicationListByTerm/${s.value}/Pending/${o.value}`),[],{resetOnExecute:!1,immediate:!1}),{isLoading:y,state:w,isReady:H,execute:x}=useAsyncState(n=>get(`api/applicationListByTerm/${s.value}/Accepted/${o.value}`),[],{resetOnExecute:!1,immediate:!1}),{isLoading:A,state:N,isReady:z,execute:I}=useAsyncState(n=>get(`api/applicationListByTerm/${s.value}/Rejected/${o.value}`),[],{resetOnExecute:!1,immediate:!1}),{isLoading:C,state:E,isReady:j,execute:U}=useAsyncState(n=>get(`api/applicationListByTerm/${s.value}/Published/${o.value}`),[],{resetOnExecute:!1,immediate:!1}),{isLoading:l,state:t,isReady:c,execute:Y}=useAsyncState(n=>get(`api/getNumOfApplicationStatus/${s.value}/${o.value}`),[],{resetOnExecute:!1,immediate:!1}),_=()=>{s.value&&o.value&&(Y(),i.value==="0"?R().then(n=>{console.log(n)}).catch(n=>{console.log(n)}):i.value==="1"?x():i.value==="2"?I():i.value==="3"&&U())};watch(o,(n,e)=>{_()}),watch(i,(n,e)=>{_()}),watch(s,(n,e)=>{K(s.value),s.value&&(_(),localStorage.setItem("selectedTerm",s.value))});const v=ref([]),f=ref(!1),K=n=>{f.value=!0,get("api/getCourseByTerm/"+n).then(e=>{v.value=[],e.forEach(d=>{v.value.push({courseID:d.courseID,courseNum:d.courseNum,courseName:d.courseName,estimatedNumOfStudents:d.estimatedNumOfStudents,currentlyNumOfStudents:d.currentlyNumOfStudents,numOfAssignments:d.numOfAssignments,numOfLabsPerWeek:d.numOfLabsPerWeek,numOfTutorialsPerWeek:d.numOfTutorialsPerWeek,tutorResponsibility:d.tutorResponsibility,markerResponsibility:d.markerResponsibility,prerequisite:d.prerequisite,termID:d.termID,termName:d.termName,totalAvailableHours:d.totalAvailableHours,currentAvailableHours:d.currentAvailableHours,needTutors:d.needTutors,needMarkers:d.needMarkers,canPreAssign:d.canPreAssign,tutorDeadLine:d.tutorDeadLine,markerDeadLine:d.markerDeadLine})}),f.value=!1})};onBeforeMount(()=>{const n=usePermissionStore();Array.from(n.key).includes("7")?o.value="marker":Array.from(n.key).includes("6")&&(o.value="tutor"),g().then(()=>{h.value.sort((e,d)=>d.termID-e.termID),localStorage.getItem("selectedTerm")?s.value=h.value.filter(e=>e.termID===parseInt(localStorage.getItem("selectedTerm")))[0].termID:s.value=h.value[0].termID,_()})});const D=ref([]),V=ref(!1),k=ref(!1),W=ref(),$=ref([]),Q=n=>{$.value=n.map(e=>e.applicationID)},J=async()=>{var n;V.value=!0,k.value=!0,D.value=[],await x(),await I(),w.value.forEach(e=>{D.value.push({applicationID:e.applicationID,userID:e.userID,name:e.name,email:e.email,upi:e.upi,status:"Accepted"})}),N.value.forEach(e=>{D.value.push({applicationID:e.applicationID,userID:e.userID,name:e.name,email:e.email,upi:e.upi,status:"Rejected"})}),(n=W.value)==null||n.toggleAllSelection(),$.value=D.value.map(e=>e.applicationID),V.value=!1},X=()=>{V.value=!0,post("api/publishApplication",$.value).then(n=>{_(),ElMessage({message:"Publish Application Result Successfully!",type:"success"}),V.value=!1,k.value=!1}).catch(n=>{ElMessage({message:n.response.data.message,type:"error"}),V.value=!1,k.value=!1})};return(n,e)=>{const d=ElOption,q=ElSelect,O=ElCol,ee=ElAlert,M=resolveComponent("font-awesome-icon"),F=ElButton,B=ElBadge,te=ElRow,S=ElTabPane,Z=ElIcon,ae=ElTabs,L=ElTableColumn,le=ElDialog,P=vLoading,G=resolveDirective("permission");return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createVNode(te,{style:{"align-items":"center"}},{default:withCtx(()=>[createVNode(O,{md:12},{default:withCtx(()=>[withDirectives((openBlock(),createBlock(q,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),class:"m-2",placeholder:"Term",style:{"margin-right":"10px"}},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(h),a=>(openBlock(),createBlock(d,{key:a.termID,label:a.termName,value:a.termID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])),[[P,unref(p)]]),createVNode(q,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value=a),class:"m-2",placeholder:"Marker or Tutor"},{default:withCtx(()=>[withDirectives(createVNode(d,{key:"marker",label:"Marker",value:"marker"},null,512),[[G,7]]),withDirectives(createVNode(d,{key:"tutor",label:"Tutor",value:"tutor"},null,512),[[G,6]])]),_:1},8,["modelValue"])]),_:1}),createVNode(O,{md:9},{default:withCtx(()=>[createVNode(ee,{title:"Tips: Rows in the table can be expanded or clicked",type:"info","show-icon":""})]),_:1}),createVNode(O,{style:{"text-align":"end"},md:3},{default:withCtx(()=>[withDirectives((openBlock(),createBlock(B,{value:unref(t).unpublished,type:"primary"},{default:withCtx(()=>[createVNode(F,{type:"success",size:"large",onClick:J},{default:withCtx(()=>[createVNode(M,{style:{"margin-right":"4px","font-size":"20px"},icon:"fa-solid fa-bullhorn"}),_hoisted_2]),_:1})]),_:1},8,["value"])),[[P,unref(l)]])]),_:1})]),_:1}),_hoisted_3,createVNode(ae,{"tab-position":"right",class:"tabs",modelValue:i.value,"onUpdate:modelValue":e[26]||(e[26]=a=>i.value=a),fixed:"right"},{default:withCtx(()=>[createVNode(S,{label:"Pending"},{label:withCtx(()=>[createBaseVNode("div",{class:normalizeClass([{selected_item:i.value==="0"},"tabs-label"])},[createVNode(M,{icon:"fa-solid fa-file-circle-question"}),_hoisted_4,createVNode(B,{value:unref(t).pending,type:"warning"},null,8,["value"])],2)]),default:withCtx(()=>[createVNode(ApprovalTable,{applicationApprovalList:unref(u),"onUpdate:applicationApprovalList":e[2]||(e[2]=a=>isRef(u)?u.value=a:null),isLoading:unref(m),"onUpdate:isLoading":e[3]||(e[3]=a=>isRef(m)?m.value=a:null),course:v.value,"onUpdate:course":e[4]||(e[4]=a=>v.value=a),isCourseLoading:f.value,"onUpdate:isCourseLoading":e[5]||(e[5]=a=>f.value=a),tutorOrMarker:o.value,"onUpdate:tutorOrMarker":e[6]||(e[6]=a=>o.value=a),tagIndex:i.value,"onUpdate:tagIndex":e[7]||(e[7]=a=>i.value=a),onReloadApplicationApprovalList:_},null,8,["applicationApprovalList","isLoading","course","isCourseLoading","tutorOrMarker","tagIndex"])]),_:1}),createVNode(S,{label:"Accepted"},{label:withCtx(()=>[createBaseVNode("div",{class:normalizeClass([{selected_item:i.value==="1"},"tabs-label"])},[createVNode(Z,null,{default:withCtx(()=>[createVNode(unref(circle_check_filled_default))]),_:1}),_hoisted_5,createVNode(B,{value:unref(t).accepted,type:"success"},null,8,["value"])],2)]),default:withCtx(()=>[createVNode(ApprovalTable,{applicationApprovalList:unref(w),"onUpdate:applicationApprovalList":e[8]||(e[8]=a=>isRef(w)?w.value=a:null),isLoading:unref(y),"onUpdate:isLoading":e[9]||(e[9]=a=>isRef(y)?y.value=a:null),course:v.value,"onUpdate:course":e[10]||(e[10]=a=>v.value=a),isCourseLoading:f.value,"onUpdate:isCourseLoading":e[11]||(e[11]=a=>f.value=a),tutorOrMarker:o.value,"onUpdate:tutorOrMarker":e[12]||(e[12]=a=>o.value=a),tagIndex:i.value,"onUpdate:tagIndex":e[13]||(e[13]=a=>i.value=a),onReloadApplicationApprovalList:_},null,8,["applicationApprovalList","isLoading","course","isCourseLoading","tutorOrMarker","tagIndex"])]),_:1}),createVNode(S,{label:"Rejected"},{label:withCtx(()=>[createBaseVNode("div",{class:normalizeClass([{selected_item:i.value==="2"},"tabs-label"])},[createVNode(Z,null,{default:withCtx(()=>[createVNode(unref(circle_close_filled_default))]),_:1}),_hoisted_6,createVNode(B,{value:unref(t).rejected},null,8,["value"])],2)]),default:withCtx(()=>[createVNode(ApprovalTable,{applicationApprovalList:unref(N),"onUpdate:applicationApprovalList":e[14]||(e[14]=a=>isRef(N)?N.value=a:null),isLoading:unref(A),"onUpdate:isLoading":e[15]||(e[15]=a=>isRef(A)?A.value=a:null),course:v.value,"onUpdate:course":e[16]||(e[16]=a=>v.value=a),isCourseLoading:f.value,"onUpdate:isCourseLoading":e[17]||(e[17]=a=>f.value=a),tutorOrMarker:o.value,"onUpdate:tutorOrMarker":e[18]||(e[18]=a=>o.value=a),tagIndex:i.value,"onUpdate:tagIndex":e[19]||(e[19]=a=>i.value=a),onReloadApplicationApprovalList:_},null,8,["applicationApprovalList","isLoading","course","isCourseLoading","tutorOrMarker","tagIndex"])]),_:1}),createVNode(S,{label:"Published"},{label:withCtx(()=>[createBaseVNode("div",{class:normalizeClass([{selected_item:i.value==="3"},"tabs-label"])},[createVNode(M,{icon:"fa-solid fa-bullhorn"}),_hoisted_7,createVNode(B,{value:unref(t).published,type:"primary"},null,8,["value"])],2)]),default:withCtx(()=>[createVNode(ApprovalTable,{applicationApprovalList:unref(E),"onUpdate:applicationApprovalList":e[20]||(e[20]=a=>isRef(E)?E.value=a:null),isLoading:unref(C),"onUpdate:isLoading":e[21]||(e[21]=a=>isRef(C)?C.value=a:null),tagIndex:i.value,"onUpdate:tagIndex":e[22]||(e[22]=a=>i.value=a),course:v.value,"onUpdate:course":e[23]||(e[23]=a=>v.value=a),isCourseLoading:f.value,"onUpdate:isCourseLoading":e[24]||(e[24]=a=>f.value=a),tutorOrMarker:o.value,"onUpdate:tutorOrMarker":e[25]||(e[25]=a=>o.value=a),onReloadApplicationApprovalList:_},null,8,["applicationApprovalList","isLoading","tagIndex","course","isCourseLoading","tutorOrMarker"])]),_:1})]),_:1},8,["modelValue"])]),createVNode(le,{modelValue:k.value,"onUpdate:modelValue":e[28]||(e[28]=a=>k.value=a),title:"Publish confirmation",width:"60%"},{footer:withCtx(()=>[createBaseVNode("span",_hoisted_8,[createVNode(F,{onClick:e[27]||(e[27]=a=>k.value=!1)},{default:withCtx(()=>[_hoisted_9]),_:1}),withDirectives((openBlock(),createBlock(F,{type:"success",onClick:X,plain:""},{default:withCtx(()=>[_hoisted_10]),_:1})),[[P,V.value]])])]),default:withCtx(()=>[withDirectives((openBlock(),createBlock(unref(ElTable),{ref_key:"publishTableRef",ref:W,data:D.value,style:{width:"100%"},onSelectionChange:Q},{default:withCtx(()=>[createVNode(L,{type:"selection",width:"55"}),createVNode(L,{property:"applicationID",label:"Application ID"}),createVNode(L,{property:"status",label:"Status"}),createVNode(L,{property:"name",label:"Name"}),createVNode(L,{property:"upi",label:"UPI"})]),_:1},8,["data"])),[[P,V.value]])]),_:1},8,["modelValue"])],64)}}}),ApplicationApproval_vue_vue_type_style_index_0_scoped_fbb2b1d2_lang="",ApplicationApproval=_export_sfc(_sfc_main,[["__scopeId","data-v-fbb2b1d2"]]);export{ApplicationApproval as default};
