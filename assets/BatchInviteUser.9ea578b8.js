import{d as T,aF as H,g as w,z as E,ak as K,a3 as J,q as O,p as Q,K as W,o as R,c as A,a as b,b as t,w as o,F as N,r as h,x as X,e as Y,u as S,aD as Z,aG as ee,aH as te,G as d,a0 as r,V as j,A as se,B as oe,_ as ae}from"./index.594ced5a.js";/* empty css                   *//* empty css               *//* empty css               *//* empty css                 */const M=x=>(se("data-v-48b701bb"),x=x(),oe(),x),ne={class:"page-container"},le={class:"table-wrapper"},re=d(" \xA0 Save "),ie=d("Add Row"),de=d("Add Student"),ce=d("Add CourseCoord"),ue=d("Delete "),pe=d("Send"),me=M(()=>b("p",null,"Are you sure to delete the selected row?",-1)),_e=M(()=>b("p",null,[d("If you choose "),b("strong",{style:{"font-weight":"bold"}},"Confirm & Save"),d(" will delete these selected columns on the server (that is, the operation is irreversible)!")],-1)),fe={class:"dialog-footer"},ve=d("Cancel"),ge=d("Confirm"),ye=d("Confirm & Save"),he=T({__name:"BatchInviteUser",setup(x){const C=H(),m=w({}),_=w(!1),v=w([]),U=w([]),g=w(!1),P=({row:s,column:e})=>{m.value.isUpdateByRow(s)&&L()},V=async s=>{let e;const a=m.value,l=a.data.map(y=>y.index);let i=0;v.value.length==0?i=1:i=Math.max(...l)+1,s===null?e={index:i,userID:"",email:"",name:"",groups:[]}:e={index:i,userID:"",email:"",name:"",groups:[s]};const{row:c}=await a.insertAt(e,-1);a.data.push(e),await(a==null?void 0:a.setEditCell(c,"userID")),console.log(a.data)},$=async()=>{if(await k(),m.value.data.length===0){r.warning("Please add users who need to be invited!");return}if(C.status!==""){r({message:"Please wait for the previous email to be sent!",type:"warning"});return}C.status="processing",E("api/inviteUser",null,0).then(e=>{console.log(e),r({message:"",type:"success"}),C.status="success"}).catch(e=>{console.log(e),r({message:e.response.data.message,type:"error"}),C.status="error"})},L=async()=>{const s=m.value;console.log(s.getRecordset());const{updateRecords:e}=s.getRecordset();if(!await(s==null?void 0:s.validate()))try{await j("api/inviteUserSaved",{insertRecords:[],removeRecords:[],updateRecords:e}).then(i=>{r({message:"Save success",type:"success"}),e.forEach(c=>{s.reloadRow(c)})}).catch(i=>{r({message:i.response.data.message,type:"error"})})}catch(l){l&&l.message&&r({message:l.message,type:"error"})}},k=async()=>{const s=m.value;console.log(s.getRecordset());const{insertRecords:e,removeRecords:a,updateRecords:l}=s.getRecordset();if(e.length<=0&&a.length<=0&&l.length<=0)return r({message:"Save: No changes",type:"warning"}),!1;if(await(s==null?void 0:s.validate()))return!1;_.value=!0;try{await j("api/inviteUserSaved",{insertRecords:e,removeRecords:a,updateRecords:l}).then(y=>{r({message:"Save success",type:"success"})}).catch(y=>{r({message:y.response.data.message,type:"error"})}),await D()}catch(c){c&&c.message&&r({message:c.message,type:"error"})}_.value=!1},G=()=>{if(m.value.getCheckboxRecords().length<=0){r({message:"Please select the row to delete",type:"warning"});return}g.value=!0},I=async()=>{const s=m.value;if(s.getCheckboxRecords().length<=0){r({message:"Please select the row to delete",type:"warning"});return}_.value=!0;const{rows:e}=await(s==null?void 0:s.removeCheckboxRow());e.forEach(a=>{const l=v.value.findIndex(i=>i.index===a.index);v.value.splice(l,1)}),_.value=!1},D=async()=>{_.value=!0;try{const s=await E("api/inviteUserSaved");v.value=s.sort((e,a)=>e.index-a.index)}catch{v.value=[]}_.value=!1};return E("api/groups").then(s=>{U.value=s}),D(),(s,e)=>{const a=h("vxe-column"),l=h("vxe-input"),i=h("vxe-option"),c=h("vxe-select"),y=K,z=h("vxe-table"),B=J,F=h("font-awesome-icon"),p=O,f=Q,q=W;return R(),A(N,null,[b("div",ne,[t(f,null,{default:o(()=>[t(B,{span:20},{default:o(()=>[b("div",le,[t(z,{ref_key:"tableRef",ref:m,border:"","keep-source":"",height:"100%",loading:_.value,"loading-config":{icon:"vxe-icon-indicator roll",text:"Loading..."},"keyboard-config":{isArrow:!0,isDel:!0,isEnter:!0,isTab:!0,isEdit:!0,isChecked:!0},data:v.value,"column-config":{resizable:!0},"edit-config":{trigger:"click",mode:"row",showStatus:!0},"sort-config":{trigger:"cell",defaultSort:{field:"age",order:"desc"},orders:["desc","asc",null]},onEditClosed:P},{empty:o(()=>[t(y,{description:"Please add users who need to be invited!"})]),default:o(()=>[t(a,{type:"checkbox",width:"50"}),t(a,{type:"seq",width:"60"}),t(a,{field:"userID",title:"UserID (UPI)","edit-render":{}},{edit:o(({row:n})=>[t(l,{modelValue:n.userID,"onUpdate:modelValue":u=>n.userID=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(a,{field:"email",title:"Email","edit-render":{}},{edit:o(({row:n})=>[t(l,{modelValue:n.email,"onUpdate:modelValue":u=>n.email=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(a,{field:"name",title:"Name","edit-render":{}},{edit:o(({row:n})=>[t(l,{modelValue:n.name,"onUpdate:modelValue":u=>n.name=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(a,{field:"groups",title:"Groups","edit-render":{}},{edit:o(({row:n})=>[t(c,{modelValue:n.groups,"onUpdate:modelValue":u=>n.groups=u,placeholder:"Select Groups",multiple:""},{default:o(()=>[(R(!0),A(N,null,X(U.value,u=>(R(),Y(i,{value:u.groupName,label:u.groupName},null,8,["value","label"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["loading","loading-config","data"])])]),_:1}),t(B,{span:4},{default:o(()=>[t(f,{justify:"center",class:"button-wrapper"},{default:o(()=>[t(p,{class:"button",type:"warning",onClick:k},{default:o(()=>[t(F,{icon:"fa-solid fa-cloud-arrow-up"}),re]),_:1})]),_:1}),t(f,{justify:"center",class:"button-wrapper"},{default:o(()=>[t(p,{class:"button",type:"primary",icon:S(Z),onClick:e[0]||(e[0]=n=>V(null))},{default:o(()=>[ie]),_:1},8,["icon"])]),_:1}),t(f,{justify:"center",class:"button-wrapper"},{default:o(()=>[t(p,{class:"button",type:"primary",onClick:e[1]||(e[1]=n=>V("student"))},{default:o(()=>[de]),_:1})]),_:1}),t(f,{justify:"center",class:"button-wrapper"},{default:o(()=>[t(p,{class:"button",type:"primary",onClick:e[2]||(e[2]=n=>V("courseCoordinator"))},{default:o(()=>[ce]),_:1})]),_:1}),t(f,{justify:"center",class:"button-wrapper"},{default:o(()=>[t(p,{class:"button",icon:S(ee),type:"danger",onClick:G},{default:o(()=>[ue]),_:1},8,["icon"])]),_:1}),t(f,{justify:"center",class:"SendButton-wrapper"},{default:o(()=>[t(p,{class:"button",type:"success",icon:S(te),size:"large",onClick:$},{default:o(()=>[pe]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})]),t(q,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=n=>g.value=n),title:"Delete Confirmation",width:"30%"},{footer:o(()=>[b("span",fe,[t(p,{onClick:e[3]||(e[3]=n=>g.value=!1)},{default:o(()=>[ve]),_:1}),t(p,{type:"warning",onClick:e[4]||(e[4]=()=>{I(),g.value=!1})},{default:o(()=>[ge]),_:1}),t(p,{type:"danger",onClick:e[5]||(e[5]=()=>{I(),k(),g.value=!1})},{default:o(()=>[ye]),_:1})])]),default:o(()=>[me,_e]),_:1},8,["modelValue"])],64)}}});const ke=ae(he,[["__scopeId","data-v-48b701bb"]]);export{ke as default};
